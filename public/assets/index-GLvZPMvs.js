var V=Object.defineProperty;var D=(n,s,t)=>s in n?V(n,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[s]=t;var _=(n,s,t)=>D(n,typeof s!="symbol"?s+"":s,t);import{r as A,j as e,c as T,B as R,t as a,u as H}from"./index-B8SYxqge.js";import{L as v}from"./dropdown-menu-BWqIsU1y.js";import{T as U}from"./theme-switch-Bn9A1eXz.js";import{H as k}from"./header-unrestricted-pages-DuOon-UZ.js";import{C as S}from"./card-0pnp7aOW.js";import{u as C,t as F,F as B,a as c,b as m,c as u,d as f,e as p}from"./form-DtwB-Oo5.js";import{z as l}from"./index-DXqQCM1T.js";import{I as E}from"./input-BkclSbQo.js";import{P as L,a as M}from"./pin-input-DArdisF2.js";import{S as O}from"./separator-BzkP7v5a.js";import{P as w}from"./password-input-BakPkVN_.js";import{r as j,d as x,u as y,g as z,c as N,p as G,o as K,a as Z,b as Y}from"./firebase-CsIHILy1.js";import"./index-7ELfpMFP.js";import"./Combination-D0dEdXlm.js";import"./index-Bxr41fyZ.js";import"./tslib.es6-CDuPK5Eb.js";import"./index-BmJrd58d.js";import"./index-C65QaNsE.js";import"./top-nav-2GSQpCCN.js";var $={VITE_FIREBASE_API_KEY:"AIzaSyAIKDhzuabGUaO52qtnQokEIpAh-Yt_TSo",VITE_FIREBASE_AUTH_DOMAIN:"zen-resort.firebaseapp.com",VITE_FIREBASE_DATABASE_URL:"https://zen-resort-default-rtdb.asia-southeast1.firebasedatabase.app",VITE_FIREBASE_PROJECT_ID:"zen-resort",VITE_FIREBASE_STORAGE_BUCKET:"zen-resort.appspot.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"47411896955",VITE_FIREBASE_APP_ID:"1:47411896955:web:36da7bf642d25bb80138de",VITE_FIREBASE_MEASUREMENT_ID:"G-X1Z3YRMMZ0",VITE_MIXPANEL_KEY:"3f85b37beb6296bd7ecd350f939c543a",VITE_CLOUD_SERVER_URL:"https://edtch.pw/",VITE_ADMIN_CODE:"212121"};const X=l.object({otp:l.string().min(1,{message:"Please enter your code."})});function q({className:n,verify_pin_callback:s,...t}){const[o,b]=A.useState(!1),[i,g]=A.useState(!0),r=C({resolver:F(X),defaultValues:{otp:""}});function h(d){d.otp===$.VITE_ADMIN_CODE?(r.reset(),b(!1),s(!0)):(r.setError("otp",{type:"manual",message:"Invalid code"}),b(!1))}return e.jsx("div",{className:T("grid gap-6",n),...t,children:e.jsx(B,{...r,children:e.jsx("form",{onSubmit:r.handleSubmit(h),children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{control:r.control,name:"otp",render:({field:d})=>e.jsxs(m,{className:"space-y-1",children:[e.jsx(u,{children:e.jsx(L,{...d,className:"flex h-10 justify-between",onComplete:()=>g(!1),onIncomplete:()=>g(!0),children:Array.from({length:7},(I,P)=>P===3?e.jsx(O,{orientation:"vertical"},P):e.jsx(M,{component:E,className:`${r.getFieldState("otp").invalid?"border-red-500":""}`},P))})}),e.jsx(f,{})]})}),e.jsx(R,{className:"mt-2",disabled:i,loading:o,children:"Verify"})]})})})})}class J{constructor(){_(this,"isReadAllowed");_(this,"isChangeAllowed");this.isReadAllowed=!0,this.isChangeAllowed=!0}async update(s){if(!this.isChangeAllowed)return a({title:"Updates have been blocked for this account, due to suspicious traffic"}),Promise.reject("Updates are blocked for this account");for(const t in s)if(t===void 0||String(t).includes("/undefined"))return a({title:"One of the addresses in the update object is undefined"}),Promise.reject("Invalid address in updates object");try{const t=j(x);return await y(t,s),Promise.resolve("Update successful")}catch(t){return console.error("Error updating database:",t),a({title:"Failed to update database"}),Promise.reject(t)}}async read(s){if(!this.isReadAllowed)return a({title:"Reads have been blocked for this account, due to suspicious traffic"}),Promise.reject("Reads have been blocked for this account, due to suspicious traffic");if(s===void 0)return a({title:"The address for read object is undefined"}),Promise.reject("The address for read object is undefined");if(String(s).includes("/undefined"))return a({title:"The address for read object is undefined"}),Promise.reject("The address for read object is undefined");if(s==="Hotel-Admins"||s==="/Hotel-Admins"||s==="Hotel-Admins/"||s==="/Hotel-Admins/")return a({title:"Cannot read from root Hotel-Admins address"}),Promise.reject("Cannot read from root Hotel-Admins address");const t=j(x);return(await z(N(t,s))).val()}async delete(s){if(!this.isChangeAllowed)return a({title:"Updates have been blocked for this account, due to suspicious traffic"}),Promise.reject("Updates are blocked for this account");for(const t of s){if(t===void 0||String(t).includes("/undefined"))return a({title:"One of the addresses in the update object is undefined"}),Promise.reject("Invalid address in updates object");if(t.split("/").length===1)return a({title:"Cannot delete from root address"}),Promise.reject("Cannot delete from root address")}try{const t=j(x);return await y(t,s.map(o=>({[o]:null}))),Promise.resolve("Delete successful")}catch(t){return console.error("Error deleting database location:",t),a({title:"Failed to delete database location"}),Promise.reject(t)}}getPushKey(s){return G(N(j(x),s)).key}async listen(s,t){if(s===void 0)return a({title:"The address for listen object is undefined"}),Promise.reject("The address for listen object is undefined");if(String(s).includes("/undefined"))return a({title:"The address for listen object is undefined"}),Promise.reject("The address for listen object is undefined");if(s==="Hotel-Admins"||s==="/Hotel-Admins"||s==="Hotel-Admins/"||s==="/Hotel-Admins/")return a({title:"Cannot listen from root Hotel-Admins address"}),Promise.reject("Cannot listen from root Hotel-Admins address");const o=j(x);K(N(o,s),t)}}const Q=new J,W=l.object({name:l.string().min(1,{message:"Please enter business name"}),email:l.string().min(1,{message:"Please enter email"}).email({message:"Invalid email address"}),phone:l.string().min(1,{message:"Please enter phone number"}),password:l.string().min(1,{message:"Please enter password"}).min(7,{message:"Password must be at least 7 characters long"}),confirmPassword:l.string()}).refine(n=>n.password===n.confirmPassword,{message:"Passwords don't match.",path:["confirmPassword"]});function Ee(){const[n,s]=A.useState(!1),[t,o]=A.useState(!1),b=H(),i=C({resolver:F(W),defaultValues:{email:"",password:"",confirmPassword:""}});function g(r){o(!0),console.log(r),Z(Y,r.email,r.password).then(h=>{const d=h.user;console.log("User created:",d);const I={};I[`ZEN-Business-Accounts/${d.uid}/SelfInfo`]={name:r.name,email:r.email,phone:r.phone,role:"hotel-admin"},Q.update(I),o(!1),a({title:"New Business Account created successfully!"}),b("/sign-in")}).catch(h=>{const d=h.message;a({title:d}),o(!1)})}return e.jsxs(v,{children:[e.jsxs(v.Header,{children:[e.jsx(k,{activeRoute:"/zen-business-admins"}),e.jsx("div",{className:"ml-auto flex items-center space-x-4",children:e.jsx(U,{})})]}),e.jsx(v.Body,{children:n===!1?e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex items-center justify-center",style:{height:"80vh"},children:e.jsx("div",{children:e.jsxs(S,{className:"p-6",children:[e.jsxs("div",{className:"mb-2 flex flex-col space-y-2 text-left",children:[e.jsx("h1",{className:"text-md font-semibold tracking-tight",children:"Zen Business Admin"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please enter the special code to access this area."})]}),e.jsx(q,{verify_pin_callback:s})]})})})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex items-center justify-center",style:{height:"80vh"},children:e.jsxs(S,{className:"p-6",style:{width:"35%"},children:[e.jsxs("div",{className:"mb-2 flex flex-col space-y-2 text-left",children:[e.jsx("h1",{className:"text-lg font-semibold tracking-tight",children:"Create Business Account"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Enter email and password to create an account. ",e.jsx("br",{})]})]}),e.jsx("div",{className:T("grid gap-6"),children:e.jsx(B,{...i,children:e.jsx("form",{onSubmit:i.handleSubmit(g),children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{control:i.control,name:"name",render:({field:r})=>e.jsxs(m,{className:"space-y-1",children:[e.jsx(p,{children:"Business Name"}),e.jsx(u,{children:e.jsx(E,{placeholder:"e.g Izakaya",...r})}),e.jsx(f,{})]})}),e.jsx(c,{control:i.control,name:"email",render:({field:r})=>e.jsxs(m,{className:"space-y-1",children:[e.jsx(p,{children:"Business Email"}),e.jsx(u,{children:e.jsx(E,{placeholder:"name@example.com",...r})}),e.jsx(f,{})]})}),e.jsx(c,{control:i.control,name:"phone",render:({field:r})=>e.jsxs(m,{className:"space-y-1",children:[e.jsx(p,{children:"Business Phone"}),e.jsx(u,{children:e.jsx(E,{placeholder:"e.g 01700766173",...r})}),e.jsx(f,{})]})}),e.jsx(c,{control:i.control,name:"password",render:({field:r})=>e.jsxs(m,{className:"space-y-1",children:[e.jsx(p,{children:"Password"}),e.jsx(u,{children:e.jsx(w,{placeholder:"********",...r})}),e.jsx(f,{})]})}),e.jsx(c,{control:i.control,name:"confirmPassword",render:({field:r})=>e.jsxs(m,{className:"space-y-1",children:[e.jsx(p,{children:"Confirm Password"}),e.jsx(u,{children:e.jsx(w,{placeholder:"********",...r})}),e.jsx(f,{})]})}),e.jsx(R,{className:"mt-2",loading:t,children:"Create Account"}),e.jsx("div",{className:"relative my-2",children:e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})})})]})})})})]})})})})]})}export{Ee as default};
